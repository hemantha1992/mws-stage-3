let restaurants,neighborhoods,cuisines,reviews,yesno=!0,favno=!1;var map,markers=[];function tgl(){1==yesno?(document.getElementById("map").style.display="none",yesno=!1,document.getElementById("bt").innerHTML="&#9788; Show Map"):(document.getElementById("map").style.display="block",yesno=!0,document.getElementById("bt").innerHTML="&#9728; Hide Map")}window.onload=function(){fetchNeighborhoods(),fetchCuisines()},checkFavourite=(e=>{favno=JSON.parse(DBHelper.restaurant_fav(e)),console.log(favno)}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.setAttribute("aria-label","listitem"),n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.setAttribute("aria-label","listitem"),n.innerHTML=e,n.value=e,t.append(n)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1,disableDefaultUI:!0}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,o=e[n].value,a=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,a,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=lozad();t.observe();const n=document.getElementById("restaurants-list");e.forEach(e=>{n.append(createRestaurantHTML(e)),t.observe()}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li");t.setAttribute("aria-label","listitem");const n=document.createElement("h2");n.innerHTML=e.name,n.setAttribute("tabindex","0"),t.append(n);const r=document.createElement("img");r.className="restaurant-img lozad",r.setAttribute("data-srcset",DBHelper.imageUrlForRestaurant_responsive(e)),r.setAttribute("data-sizes",DBHelper.imageUrlForRestaurant_sizes(e)),r.setAttribute("data-src",DBHelper.imageUrlForLazy_load(e)),r.alt="An image from restaurant "+e.name,t.append(r);const o=document.createElement("p");o.innerHTML=e.neighborhood,t.append(o);const a=document.createElement("p");a.innerHTML=e.address,t.append(a);const s=document.createElement("button");s.setAttribute("type","button"),s.setAttribute("tabindex","0"),s.setAttribute("style","width:60px;height:40px;margin:10px;color:olive;background-color:lemonchiffon;font-weight:bold;font-size:large;padding:5px;border-radius:10px;"),s.setAttribute("aria-label","mark as favorite"),s.onclick=function(){0==favno?(favno=!0,console.log(favno),s.setAttribute("style","width:60px;height:40px;margin:10px;color:red;background-color:lemonchiffon;font-weight:bold;font-size:large;padding:5px;border-radius:10px;"),el.setAttribute("aria-label","marked as favorite")):(favno=!1,s.setAttribute("style","width:60px;height:40px;margin:10px;color:olive;background-color:lemonchiffon;font-weight:bold;font-size:large;padding:5px;border-radius:10px;"),el.setAttribute("aria-label","marked as unfavorite"));var t={is_favorite:favno};return fetch("http://localhost:1337/restaurants/"+e.id,{method:"PUT",body:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(){return idb.open("restaurants",1)}).then(function(t){var n=t.transaction("details","readwrite"),r=n.objectStore("details");return e.is_favorite=favno,r.put(e),n.complete}).then(e=>{console.log(e)}).catch(e=>console.log(e))},s.innerHTML="&#10084;",t.append(s);const i=document.createElement("a");return i.innerHTML='<span style="font-size:large;"> &#127869;</span> View Details',i.href=DBHelper.urlForRestaurant(e),t.append(i),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then(function(e){}).catch(function(e){console.log("Service Worker registration failed: ",e)});