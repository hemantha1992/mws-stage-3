let restaurant,review;var map;function offlinePosting(){if("true"==localStorage.getItem("gotData")){var e={restaurant_id:Number(localStorage.getItem("restaurant_id")),name:localStorage.getItem("name"),rating:Number(localStorage.getItem("rating")),comments:localStorage.getItem("comments")};return localStorage.clear(),fetch("http://localhost:1337/reviews/",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(e=>(console.log(e.json()),updateReviewsIdb())).then(()=>{const t=document.getElementById("reviews-list");t.appendChild(updateReviewHTML(e)),document.getElementById("reviews-container").appendChild(t)})}}function postReview(){var e,t,n,a;e=document.getElementById("restaurant_id").value,t=document.getElementById("name").value,n=document.getElementById("rating").value,a=document.getElementById("comments").value;var r={restaurant_id:Number(e),name:t,rating:Number(n),comments:a};if(1==navigator.onLine)return localStorage.setItem("gotData",!1),""==document.getElementById("name").value||""==document.getElementById("rating").value||""==document.getElementById("comments").value?"":(document.getElementById("btn").style.backgroundColor="green",document.getElementById("btn").style.color="white",document.getElementById("btn").value="Sent",document.getElementById("btn").disabled=!0,fetch("http://localhost:1337/reviews/",{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(()=>(r.createdAt=(new Date).toJSON(),r.updatedAt=(new Date).toJSON(),updateReviewsIdb(r))).then(()=>{const e=document.getElementById("reviews-list");e.appendChild(updateReviewHTML(r)),document.getElementById("reviews-container").appendChild(e)}));{localStorage.clear(),localStorage.setItem("gotData",!0),localStorage.setItem("restaurant_id",Number(e)),localStorage.setItem("name",t),localStorage.setItem("rating",Number(n)),localStorage.setItem("comments",a),r.createdAt=(new Date).toJSON(),r.updatedAt=(new Date).toJSON(),document.getElementById("btn").style.backgroundColor="red",document.getElementById("btn").style.color="white",document.getElementById("btn").value="Offline",document.getElementById("btn").disabled=!0;const i=document.getElementById("reviews-list");return i.appendChild(updateReviewHTML(r)),document.getElementById("reviews-container").appendChild(i),updateReviewsIdb(r)}}function updateReviewsIdb(e){return idb.open("reviews",1).then(function(t){var n=t.transaction("details","readwrite"),a=n.objectStore("details");console.log(e),a.add(e),n.complete}).then(function(){console.log("Reviews - all items updated successfully!")}).catch(function(e){tx.abort(),console.log(e)})}window.onload=offlinePosting(),window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1,disableDefaultUI:!0}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{const t=document.getElementById("restaurant-name");t.innerHTML=e.name,t.setAttribute("tabindex","0");const n=document.getElementById("restaurant-address");n.innerHTML=e.address,n.setAttribute("tabindex","0");const a=document.getElementById("restaurant-img");a.className="restaurant-img",a.alt=e.name,a.sizes=DBHelper.imageUrlForRestaurant_sizes(e),a.srcset=DBHelper.imageUrlForRestaurant_responsive(e),a.src=DBHelper.imageUrlForRestaurant(e);const r=document.getElementById("restaurant-cuisine");r.innerHTML=e.cuisine_type,r.setAttribute("tabindex","0"),e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");t.setAttribute("tabindex","0");for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,a.appendChild(r);const i=document.createElement("td");i.innerHTML=e[n],a.appendChild(i),t.appendChild(a)}}),fillReviewsHTML=(e=>{const t=parseInt(getParameterByName("id"));DBHelper.fetchReviews((n,a)=>{if(n)console.log(n);else{var r=[];a.forEach(function(e){e.restaurant_id==t&&r.push(e)}),e=r;const n=document.getElementById("reviews-container"),E=document.createElement("h3");E.innerHTML="Reviews",E.setAttribute("tabindex","0"),E.setAttribute("id","rvwh"),n.appendChild(E);var i=document.createElement("form");i.setAttribute("id","commentForm"),i.setAttribute("style","padding:10px;"),i.setAttribute("tabindex","0"),i.setAttribute("aria-label","form");var l=document.createElement("P"),d=document.createElement("P"),o=document.createElement("P"),s=document.createElement("P"),u=document.createElement("P"),c=document.createElement("P"),m=document.createElement("input");m.type="hidden",m.name="restaurant_id",m.id="restaurant_id",m.value=t,m.setAttribute("tabindex","0"),m.setAttribute("aria-label","text-box");var p=document.createElement("label");p.innerText="Name: ",p.setAttribute("tabindex","0"),p.setAttribute("aria-label","label");var b=document.createElement("input");b.type="text",b.name="name",b.id="name",b.style="margin:5px;text-align:center;width:150px;height:20px;border-radius:8px;",b.setAttribute("tabindex","0"),b.setAttribute("aria-label","text-box");var g=document.createElement("label");g.setAttribute("tabindex","0"),g.setAttribute("aria-label","label"),g.innerText="Rating: (1 - 5) ";var h=document.createElement("input");h.type="text",h.name="rating",h.id="rating",h.style="margin:5px;text-align:center;width:150px;height:20px;border-radius:8px;",h.setAttribute("tabindex","0"),h.setAttribute("aria-label","text-box");var x=document.createElement("label");x.setAttribute("tabindex","0"),x.setAttribute("aria-label","label"),x.innerText="Comments: ";var v=document.createElement("textarea");v.type="text",v.name="comments",v.id="comments",v.cols=50,v.rows=5,v.style="padding:10px;margin:10px;width:300px;border-radius:8px;",v.setAttribute("tabindex","0"),v.setAttribute("aria-label","text-area");var A=document.createElement("input");if(A.setAttribute("type","button"),A.setAttribute("value","Submit"),A.setAttribute("onclick","postReview()"),A.setAttribute("id","btn"),A.setAttribute("style","margin-bottom:10px;padding:5px;border-radius:5px;width:60px;height:30px;"),A.setAttribute("tabindex","0"),A.setAttribute("aria-label","submit-button"),i.appendChild(m),i.appendChild(p),i.appendChild(l),i.appendChild(b),i.appendChild(d),i.appendChild(g),i.appendChild(o),i.appendChild(h),i.appendChild(s),i.appendChild(x),i.appendChild(u),i.appendChild(v),i.appendChild(c),i.appendChild(A),n.appendChild(i),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void n.appendChild(e)}const y=document.getElementById("reviews-list");y.setAttribute("tabindex","0"),y.setAttribute("role","listbox"),y.setAttribute("aria-label","review-list"),e.forEach(e=>{y.appendChild(createReviewHTML(e))}),n.appendChild(y)}})}),updateReviewsHTML=(e=>{const t=parseInt(getParameterByName("id"));DBHelper.fetchReviews((n,a)=>{if(n)console.log(n);else{var r=[];a.forEach(function(e){e.restaurant_id==t&&r.push(e)}),e=r;const n=document.getElementById("reviews-container"),E=document.createElement("h3");E.innerHTML="Reviews",E.setAttribute("tabindex","0"),E.setAttribute("id","rvwh"),n.appendChild(E);var i=document.createElement("form");i.setAttribute("id","commentForm"),i.setAttribute("style","padding:10px;"),i.setAttribute("tabindex","0"),i.setAttribute("aria-label","form");var l=document.createElement("P"),d=document.createElement("P"),o=document.createElement("P"),s=document.createElement("P"),u=document.createElement("P"),c=document.createElement("P"),m=document.createElement("input");m.type="hidden",m.name="restaurant_id",m.id="restaurant_id",m.value=t,m.setAttribute("tabindex","0"),m.setAttribute("aria-label","text-box");var p=document.createElement("label");p.innerText="Name: ",p.setAttribute("tabindex","0"),p.setAttribute("aria-label","label");var b=document.createElement("input");b.type="text",b.name="name",b.id="name",b.style="margin:5px;text-align:center;width:150px;height:20px;",b.setAttribute("tabindex","0"),b.setAttribute("aria-label","text-box");var g=document.createElement("label");g.setAttribute("tabindex","0"),g.setAttribute("aria-label","label"),g.innerText="Rating: (1 - 5) ";var h=document.createElement("input");h.type="text",h.name="rating",h.id="rating",h.style="margin:5px;text-align:center;width:150px;height:20px;",h.setAttribute("tabindex","0"),h.setAttribute("aria-label","text-box");var x=document.createElement("label");x.setAttribute("tabindex","0"),x.setAttribute("aria-label","label"),x.innerText="Comments: ";var v=document.createElement("textarea");v.type="text",v.name="comments",v.id="comments",v.cols=50,v.rows=5,v.style="padding:10px;margin:10px;width:300px;",v.setAttribute("tabindex","0"),v.setAttribute("aria-label","text-area");var A=document.createElement("input");if(A.setAttribute("type","button"),A.setAttribute("value","Submit"),A.setAttribute("onclick","postReview()"),A.setAttribute("id","btn"),A.setAttribute("style","margin-bottom:10px;padding:5px;border-radius:5px;width:60px;height:30px;"),A.setAttribute("tabindex","0"),A.setAttribute("aria-label","submit-button"),i.appendChild(m),i.appendChild(p),i.appendChild(l),i.appendChild(b),i.appendChild(d),i.appendChild(g),i.appendChild(o),i.appendChild(h),i.appendChild(s),i.appendChild(x),i.appendChild(u),i.appendChild(v),i.appendChild(c),i.appendChild(A),n.appendChild(i),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void n.appendChild(e)}const y=document.getElementById("reviews-list");y.setAttribute("tabindex","0"),y.setAttribute("role","listbox"),y.setAttribute("aria-label","review-list"),e.forEach(e=>{y.appendChild(createReviewHTML(e))}),n.appendChild(y)}})}),updateReviewHTML=(e=>{const t=document.createElement("li");t.setAttribute("tabindex","0"),t.setAttribute("role","listitem");const n=document.createElement("p");n.setAttribute("tabindex","0"),n.innerHTML=e.name,t.appendChild(n);const a=document.createElement("p");a.setAttribute("tabindex","0");var r=(new Date).toLocaleString();a.innerHTML=r,t.appendChild(a);const i=document.createElement("p");i.innerHTML=e.rating,i.setAttribute("tabindex","0"),t.appendChild(i);const l=document.createElement("p");return l.setAttribute("style","text-align:left;"),l.setAttribute("tabindex","0"),l.innerHTML=e.comments,t.appendChild(l),t}),createReviewHTML=(e=>{const t=document.createElement("li");t.setAttribute("tabindex","0"),t.setAttribute("role","listitem");const n=document.createElement("p");n.setAttribute("tabindex","0"),n.innerHTML=e.name,t.appendChild(n);const a=document.createElement("p");a.setAttribute("tabindex","0");var r=new Date(e.createdAt);a.innerHTML=r.toLocaleString(),t.appendChild(a);const i=document.createElement("p");i.innerHTML=`Rating: ${e.rating}`,i.setAttribute("tabindex","0"),t.appendChild(i);const l=document.createElement("p");return l.setAttribute("style","text-align:left;"),l.setAttribute("tabindex","0"),l.innerHTML=e.comments,t.appendChild(l),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.setAttribute("tabindex","0"),n.setAttribute("aria-current","page"),n.setAttribute("role","listitem"),n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then(function(e){console.log("Service Worker registration successful with scope: ",e.scope)}).catch(function(e){console.log("Service Worker registration failed: ",e)});